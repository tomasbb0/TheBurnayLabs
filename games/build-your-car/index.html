<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöó Constr√≥i o Teu Carro! - Build Your Car!</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Nunito', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .game-card { background: white; border-radius: 24px; padding: 32px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        h1 { font-size: 2.5rem; text-align: center; margin-bottom: 8px; }
        h2 { font-size: 1.2rem; text-align: center; color: #6B7280; margin-bottom: 24px; }
        .car-display { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin: 24px 0; padding: 24px; background: #F3F4F6; border-radius: 16px; }
        .car-part { width: 80px; height: 80px; background: #E5E7EB; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; transition: all 0.3s; }
        .car-part.unlocked { background: #D1FAE5; transform: scale(1.1); }
        .car-part.locked { opacity: 0.5; }
        .question-box { background: #EEF2FF; border-radius: 16px; padding: 24px; margin: 24px 0; text-align: center; }
        .question-emoji { font-size: 4rem; margin-bottom: 16px; }
        .question-text { font-size: 1.5rem; font-weight: 700; color: #1F2937; margin-bottom: 8px; }
        .question-hint { font-size: 1rem; color: #6B7280; }
        .answers { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 24px; }
        .answer-btn { padding: 16px 24px; font-size: 1.2rem; font-weight: 600; border: 3px solid #E5E7EB; border-radius: 12px; background: white; cursor: pointer; transition: all 0.2s; font-family: inherit; }
        .answer-btn:hover { border-color: #818CF8; background: #EEF2FF; transform: translateY(-2px); }
        .answer-btn.correct { background: #D1FAE5; border-color: #10B981; }
        .answer-btn.wrong { background: #FEE2E2; border-color: #EF4444; }
        .progress { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .stars { font-size: 1.5rem; }
        .level-badge { background: #4F46E5; color: white; padding: 8px 16px; border-radius: 20px; font-weight: 700; }
        .celebration { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 100; }
        .celebration-content { background: white; border-radius: 24px; padding: 48px; text-align: center; max-width: 500px; }
        .celebration h2 { font-size: 2rem; margin: 16px 0; }
        .celebration .emoji { font-size: 5rem; }

        /* Small transient success splash (for each correct answer) */
        .success-splash { position: fixed; left: 50%; top: 18%; transform: translateX(-50%) translateY(-10px); background: linear-gradient(90deg, #10B981, #06B6D4); color: white; padding: 12px 24px; border-radius: 20px; font-weight: 800; font-size: 1.25rem; z-index: 200; opacity: 0; transition: all 0.35s cubic-bezier(.22,.9,.25,1); }
        .success-splash.visible { opacity: 1; transform: translateX(-50%) translateY(0) scale(1.05); }

        /* Failure splash */
        .failure-splash { position: fixed; left: 50%; top: 18%; transform: translateX(-50%) translateY(-10px); background: linear-gradient(90deg,#EF4444,#F97316); color:white; padding:12px 24px; border-radius:20px; font-weight:800; z-index:200; opacity:0; transition: all 0.35s cubic-bezier(.22,.9,.25,1); }
        .failure-splash.visible { opacity:1; transform: translateX(-50%) translateY(0) scale(1.05); }

        /* Unlock notice */
        .unlock-notice { position: fixed; left:50%; top:12%; transform: translateX(-50%) translateY(-12px); background: #111827; color: white; padding: 14px 20px; border-radius: 12px; z-index: 210; opacity:0; transition: all .35s; box-shadow: 0 10px 30px rgba(0,0,0,0.3); pointer-events: none; }
        .unlock-notice.visible { opacity:1; transform: translateX(-50%) translateY(0) scale(1.02); }
        .play-btn { background: #4F46E5; color: white; border: none; padding: 16px 48px; font-size: 1.2rem; font-weight: 700; border-radius: 12px; cursor: pointer; font-family: inherit; margin-top: 16px; }
        .play-btn:hover { background: #4338CA; }
        .hidden { display: none !important; }
        .score-display { text-align: center; font-size: 1.1rem; color: #4B5563; }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-card">
            <h1>üöó Constr√≥i o Teu Carro!</h1>
            <h2>Build Your Car!</h2>
            
            <div class="progress">
                <span class="stars" id="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                <span class="level-badge" id="level">N√≠vel 1</span>
            </div>
            <div class="score-display">Pe√ßas: <span id="parts">0</span>/6</div>
            
            <div class="car-display" id="car">
                <div style="display: grid; grid-template-columns: repeat(4, 50px); grid-template-rows: repeat(3, 50px); gap: 2px; margin: 0 auto; justify-items: center; align-items: center;">
                    <div style="grid-column: 2 / 4; grid-row: 1;"><div class="car-part locked" id="part-3">ü™ü</div></div>
                    <div style="grid-column: 1 / 2; grid-row: 2;"><div class="car-part locked" id="part-0">üöó</div></div>
                    <div style="grid-column: 2 / 4; grid-row: 2; display: flex; justify-content: center;"><div class="car-part locked" id="part-4">üö™</div></div>
                    <div style="grid-column: 4 / 5; grid-row: 2;"><div class="car-part locked" id="part-5">üí°</div></div>
                    <div style="grid-column: 1 / 2; grid-row: 3;"><div class="car-part locked" id="part-1">‚ö´</div></div>
                    <div style="grid-column: 4 / 5; grid-row: 3;"><div class="car-part locked" id="part-2">‚ö´</div></div>
                </div>
            </div>
            
            <div class="question-box">
                <div class="question-emoji" id="emoji">üî¥</div>
                <div class="question-text" id="question">Que cor √© esta?</div>
                <div class="question-hint" id="hint">What color is this?</div>
            </div>
            
            <div class="answers" id="answers"></div>
        </div>
    </div>
    
    <div class="celebration hidden" id="celebration">
        <div class="celebration-content">
            <div class="emoji">üéâüöóüéâ</div>
            <h2>Parab√©ns! Congratulations!</h2>
            <p>Constru√≠ste o teu carro! You built your car!</p>
            <button class="play-btn" onclick="location.reload()">Jogar Novamente / Play Again</button>
        </div>
    </div>
    
    <script>
        const levels = [
            { theme: 'Cores', questions: [
                { emoji: 'üî¥', q: 'Que cor √© esta?', hint: 'What color?', answer: 'Vermelho', options: ['Vermelho', 'Azul', 'Verde', 'Amarelo'] },
                { emoji: 'üîµ', q: 'Que cor √© esta?', hint: 'What color?', answer: 'Azul', options: ['Vermelho', 'Azul', 'Verde', 'Amarelo'] },
                { emoji: 'üü°', q: 'Que cor √© esta?', hint: 'What color?', answer: 'Amarelo', options: ['Laranja', 'Azul', 'Branco', 'Amarelo'] }
            ]},
            { theme: 'N√∫meros', questions: [
                { emoji: '‚òùÔ∏è', q: 'Quantos dedos?', hint: 'How many fingers?', answer: 'Um', options: ['Um', 'Dois', 'Tr√™s', 'Quatro'] },
                { emoji: '‚úåÔ∏è', q: 'Quantos dedos?', hint: 'How many fingers?', answer: 'Dois', options: ['Um', 'Dois', 'Tr√™s', 'Cinco'] },
                { emoji: 'üñêÔ∏è', q: 'Quantos dedos?', hint: 'How many fingers?', answer: 'Cinco', options: ['Tr√™s', 'Quatro', 'Cinco', 'Seis'] }
            ]},
            { theme: 'Animais', questions: [
                { emoji: 'üêï', q: 'O que √© isto?', hint: 'What is this?', answer: 'C√£o', options: ['Gato', 'C√£o', 'P√°ssaro', 'Peixe'] },
                { emoji: 'üê±', q: 'O que √© isto?', hint: 'What is this?', answer: 'Gato', options: ['C√£o', 'Gato', 'Rato', 'Le√£o'] },
                { emoji: 'üêü', q: 'O que √© isto?', hint: 'What is this?', answer: 'Peixe', options: ['Peixe', 'Pato', 'Sapo', 'Baleia'] }
            ]},
            { theme: 'Fam√≠lia', questions: [
                { emoji: 'üë©', q: 'Quem √©?', hint: 'Who is this?', answer: 'M√£e', options: ['M√£e', 'Pai', 'Irm√£', 'Av√≥'] },
                { emoji: 'üë®', q: 'Quem √©?', hint: 'Who is this?', answer: 'Pai', options: ['M√£e', 'Pai', 'Irm√£o', 'Av√¥'] },
                { emoji: 'üëß', q: 'Quem √©?', hint: 'Who is this?', answer: 'Menina', options: ['Menina', 'Menino', 'Beb√©', 'Mulher'] }
            ]},
            { theme: 'Corpo', questions: [
                { emoji: 'üëã', q: 'O que √© isto?', hint: 'What is this?', answer: 'M√£o', options: ['P√©', 'M√£o', 'Bra√ßo', 'Dedo'] },
                { emoji: 'üëÉ', q: 'O que √© isto?', hint: 'What is this?', answer: 'Nariz', options: ['Boca', 'Olho', 'Nariz', 'Orelha'] },
                { emoji: 'üëÇ', q: 'O que √© isto?', hint: 'What is this?', answer: 'Orelha', options: ['Nariz', 'Boca', 'Olho', 'Orelha'] }
            ]},
            { theme: 'Comida', questions: [
                { emoji: 'üçé', q: 'O que √© isto?', hint: 'What is this?', answer: 'Ma√ß√£', options: ['Banana', 'Ma√ß√£', 'Laranja', 'Uva'] },
                { emoji: 'üçï', q: 'O que √© isto?', hint: 'What is this?', answer: 'Pizza', options: ['Pizza', 'Hamb√∫rguer', 'Salada', 'Sopa'] },
                { emoji: 'üç¶', q: 'O que √© isto?', hint: 'What is this?', answer: 'Gelado', options: ['Bolo', 'Gelado', 'Chocolate', 'Doce'] }
            ]}
        ];
        
        let currentLevel = 0, currentQ = 0, stars = 5, parts = 0;
        const partNames = ['Body','Left Wheel','Right Wheel','Window','Door','Headlight'];
        
        function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }
        
        function showQuestion() {
            const level = levels[currentLevel];
            const q = level.questions[currentQ];
            document.getElementById('level').textContent = 'N√≠vel ' + (currentLevel + 1) + ': ' + level.theme;
            document.getElementById('emoji').textContent = q.emoji;
            document.getElementById('question').textContent = q.q;
            document.getElementById('hint').textContent = q.hint;
            
            const answersDiv = document.getElementById('answers');
            answersDiv.innerHTML = '';
            shuffle([...q.options]).forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = opt;
                btn.disabled = false; // ensure buttons are enabled
                btn.onclick = () => checkAnswer(opt, q.answer, btn);
                answersDiv.appendChild(btn);
            });
        }
        
        function checkAnswer(selected, correct, btn) {
            const btns = document.querySelectorAll('.answer-btn');
            btns.forEach(b => b.disabled = true);

            if (selected === correct) {
                btn.classList.add('correct');
                // schedule progression first so audio/UI errors cannot block the game
                setTimeout(() => nextQuestion(), 800);
                try { playCheerSound(); } catch(e) { /* ignore audio errors */ }
                try { showSuccessSplash('Parab√©ns! üéâ'); } catch(e) { /* ignore UI errors */ }
            } else {
                btn.classList.add('wrong');
                // schedule progression even if sound/UI fails
                setTimeout(() => nextQuestion(), 1500);
                try { playOhSound(); } catch(e) { /* ignore audio errors */ }
                stars = Math.max(0, stars - 1);
                document.getElementById('stars').textContent = '‚≠ê'.repeat(stars) + '‚òÜ'.repeat(5 - stars);
                btns.forEach(b => { if (b.textContent === correct) b.classList.add('correct'); });
                try { showFailureSplash('Ohhhh...'); } catch(e) { /* ignore UI errors */ }
            }
        }
        
        function nextQuestion() {
            currentQ++;
            if (currentQ >= levels[currentLevel].questions.length) {
                // Unlock part
                const unlockedPart = partNames[currentLevel];
                document.getElementById('part-' + currentLevel).classList.remove('locked');
                document.getElementById('part-' + currentLevel).classList.add('unlocked');
                parts++;
                document.getElementById('parts').textContent = parts;
                // Play unlock pling
                playPling();
                
                currentLevel++;
                currentQ = 0;
                
                if (currentLevel >= levels.length) {
                    document.getElementById('celebration').classList.remove('hidden');
                    return;
                }
            }
            showQuestion();
        }

        // Play a short success chime using the WebAudio API (no external files needed)
        function playSuccessSound() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const now = ctx.currentTime;
                const o = ctx.createOscillator();
                const g = ctx.createGain();
                o.type = 'sine';
                o.frequency.setValueAtTime(880, now);
                o.frequency.exponentialRampToValueAtTime(660, now + 0.12);
                g.gain.setValueAtTime(0.0001, now);
                g.gain.exponentialRampToValueAtTime(0.25, now + 0.01);
                g.gain.exponentialRampToValueAtTime(0.0001, now + 0.25);
                o.connect(g);
                g.connect(ctx.destination);
                o.start(now);
                o.stop(now + 0.25);
            } catch (e) { /* WebAudio not supported */ }
        }

        // Show a small transient splash message for correct answers
        function showSuccessSplash(text = 'Parab√©ns! üéâ') {
            const s = document.createElement('div');
            s.className = 'success-splash';
            s.textContent = text;
            document.body.appendChild(s);
            requestAnimationFrame(() => s.classList.add('visible'));
            setTimeout(() => { s.classList.remove('visible'); setTimeout(() => s.remove(), 400); }, 800);
        }
        
        showQuestion();
        
        // Audio utilities and small UI helpers for celebration, failure, and unlock notices
        function getAudioContext() {
            try { return window._audioCtx || (window._audioCtx = new (window.AudioContext || window.webkitAudioContext)()); } catch(e) { return null; }
        }
        function playCheerSound() {
            try {
                const ctx = getAudioContext(); if (!ctx) return;
                if (ctx.state === 'suspended' && typeof ctx.resume === 'function') { ctx.resume().catch(()=>{}); }
                const now = ctx.currentTime;
                // Uplifting ascending chord: C5, E5, G5 (bright and cheerful)
                const freqs = [1046, 1319, 1568];
                const g = ctx.createGain();
                g.gain.setValueAtTime(0.0001, now);
                g.gain.exponentialRampToValueAtTime(0.35, now + 0.05);
                g.gain.exponentialRampToValueAtTime(0.0001, now + 0.6);
                g.connect(ctx.destination);
                freqs.forEach((f, i) => {
                    const o = ctx.createOscillator();
                    o.type = 'sine';
                    o.frequency.setValueAtTime(f, now + i * 0.05);
                    o.connect(g);
                    o.start(now + i * 0.05);
                    o.stop(now + 0.55);
                });
            } catch (e) { /* swallow errors so audio doesn't break the game */ }
        }
        function playOhSound() {
            try {
                const ctx = getAudioContext(); if (!ctx) return;
                if (ctx.state === 'suspended' && typeof ctx.resume === 'function') { ctx.resume().catch(()=>{}); }
                const now = ctx.currentTime;
                // Sad descending tone
                const o = ctx.createOscillator();
                const g = ctx.createGain();
                o.type = 'sine';
                o.frequency.setValueAtTime(350, now);
                o.frequency.exponentialRampToValueAtTime(150, now + 0.5);
                g.gain.setValueAtTime(0.0001, now);
                g.gain.exponentialRampToValueAtTime(0.3, now + 0.05);
                g.gain.exponentialRampToValueAtTime(0.0001, now + 0.7);
                o.connect(g);
                g.connect(ctx.destination);
                o.start(now);
                o.stop(now + 0.7);
            } catch (e) { /* ignore audio errors */ }
        }
        function playPling() {
            try {
                const ctx = getAudioContext(); if (!ctx) return;
                if (ctx.state === 'suspended' && typeof ctx.resume === 'function') { ctx.resume().catch(()=>{}); }
                const now = ctx.currentTime; const o = ctx.createOscillator(); const g = ctx.createGain();
                o.type='triangle'; o.frequency.setValueAtTime(1320, now); o.frequency.exponentialRampToValueAtTime(660, now+0.12);
                g.gain.setValueAtTime(0.0001, now); g.gain.exponentialRampToValueAtTime(0.25, now+0.01); g.gain.exponentialRampToValueAtTime(0.0001, now+0.3);
                o.connect(g); g.connect(ctx.destination); o.start(now); o.stop(now+0.28);
            } catch (e) { /* ignore audio errors */ }
        }
        function showFailureSplash(text='Ohhhh...') {
            const s = document.createElement('div'); s.className='failure-splash'; s.textContent=text; document.body.appendChild(s);
            requestAnimationFrame(()=> s.classList.add('visible'));
            setTimeout(()=> { s.classList.remove('visible'); setTimeout(()=> s.remove(), 400); }, 1200);
        }
        
        // One-time resume of AudioContext on first user gesture to ensure sounds play
        (function initAudioOnGesture(){
            const handler = () => {
                try {
                    const ctx = getAudioContext();
                    if (ctx && ctx.state === 'suspended' && typeof ctx.resume === 'function') ctx.resume().catch(()=>{});
                } catch(e) {}
                document.removeEventListener('pointerdown', handler);
            };
            document.addEventListener('pointerdown', handler, {passive:true});
        })();
    </script>
</body>
</html>
