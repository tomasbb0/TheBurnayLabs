<!doctype html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simon Says ‚Äî Portuguese!</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        overflow: hidden;
      }
      body {
        font-family: "Nunito", sans-serif;
        background: #0b0716;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* === Animated BG === */
      .bg {
        position: fixed;
        inset: 0;
        z-index: 0;
        overflow: hidden;
      }
      .bg-orb {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.18;
        animation: orbMove 20s ease-in-out infinite alternate;
      }
      .bg-orb:nth-child(1) {
        width: 500px;
        height: 500px;
        background: #7c3aed;
        top: -10%;
        left: -10%;
        animation-delay: 0s;
      }
      .bg-orb:nth-child(2) {
        width: 400px;
        height: 400px;
        background: #ec4899;
        bottom: -10%;
        right: -10%;
        animation-delay: -7s;
      }
      .bg-orb:nth-child(3) {
        width: 350px;
        height: 350px;
        background: #f59e0b;
        top: 50%;
        left: 60%;
        animation-delay: -14s;
      }
      @keyframes orbMove {
        0% {
          transform: translate(0, 0) scale(1);
        }
        50% {
          transform: translate(60px, -40px) scale(1.15);
        }
        100% {
          transform: translate(-30px, 50px) scale(0.9);
        }
      }

      /* === Container === */
      .game-wrap {
        position: relative;
        z-index: 1;
        width: 100%;
        max-width: 480px;
        padding: 16px;
        display: flex;
        flex-direction: column;
      }

      /* === Screens === */
      .screen {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
      }
      .screen.active {
        display: flex;
      }

      /* === WELCOME === */
      .logo {
        font-size: 5rem;
        margin-bottom: 4px;
        animation: logoBounce 2.5s ease-in-out infinite;
      }
      @keyframes logoBounce {
        0%,
        100% {
          transform: translateY(0) rotate(0deg);
        }
        25% {
          transform: translateY(-12px) rotate(-3deg);
        }
        75% {
          transform: translateY(-6px) rotate(2deg);
        }
      }
      .title {
        font-size: clamp(1.8rem, 5vw, 2.6rem);
        font-weight: 900;
        background: linear-gradient(135deg, #a78bfa, #ec4899, #f59e0b);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1.2;
      }
      .subtitle {
        color: #9b8fc2;
        font-size: 1rem;
        margin: 4px 0 24px;
        font-weight: 600;
      }
      .desc {
        color: #7b6fa0;
        font-size: 0.9rem;
        max-width: 340px;
        line-height: 1.6;
        margin-bottom: 28px;
      }

      .big-btn {
        background: linear-gradient(135deg, #7c3aed, #ec4899);
        border: none;
        color: #fff;
        padding: 16px 56px;
        font-size: 1.25rem;
        font-weight: 800;
        border-radius: 50px;
        cursor: pointer;
        font-family: inherit;
        transition: 0.2s;
        box-shadow: 0 6px 30px rgba(124, 58, 237, 0.45);
        position: relative;
        overflow: hidden;
      }
      .big-btn:hover {
        transform: translateY(-2px) scale(1.03);
        box-shadow: 0 10px 40px rgba(124, 58, 237, 0.6);
      }
      .big-btn:active {
        transform: scale(0.97);
      }
      .big-btn .shine {
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        animation: shine 2.5s infinite;
      }
      @keyframes shine {
        to {
          left: 100%;
        }
      }

      /* === TUTORIAL === */
      .tut-card {
        background: rgba(26, 17, 40, 0.9);
        border: 1px solid rgba(167, 139, 250, 0.15);
        border-radius: 20px;
        padding: 32px 24px;
        backdrop-filter: blur(20px);
        width: 100%;
        max-width: 400px;
      }
      .tut-step {
        display: none;
        animation: fadeUp 0.4s ease;
      }
      .tut-step.active {
        display: block;
      }
      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(16px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .tut-icon {
        font-size: 4rem;
        margin-bottom: 10px;
      }
      .tut-title {
        font-size: 1.4rem;
        font-weight: 800;
        color: #a78bfa;
        margin-bottom: 8px;
      }
      .tut-text {
        color: #9b8fc2;
        font-size: 0.95rem;
        line-height: 1.6;
        margin-bottom: 20px;
      }
      .tut-text b {
        color: #fff;
      }
      .tut-dots {
        display: flex;
        justify-content: center;
        gap: 6px;
        margin-bottom: 16px;
      }
      .tut-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(167, 139, 250, 0.2);
        transition: 0.3s;
      }
      .tut-dot.on {
        background: #a78bfa;
        width: 20px;
        border-radius: 4px;
      }
      .tut-btn {
        background: #7c3aed;
        border: none;
        color: #fff;
        padding: 12px 36px;
        font-size: 1rem;
        font-weight: 700;
        border-radius: 12px;
        cursor: pointer;
        font-family: inherit;
        transition: 0.2s;
      }
      .tut-btn:hover {
        background: #6d28d9;
        transform: translateY(-1px);
      }

      /* === HUD === */
      .hud {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 16px;
        background: rgba(26, 17, 40, 0.7);
        border-radius: 14px;
        border: 1px solid rgba(167, 139, 250, 0.1);
        margin-bottom: 12px;
        backdrop-filter: blur(10px);
        flex-shrink: 0;
      }
      .hud-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 700;
        font-size: 0.9rem;
      }
      .hud-score {
        color: #f59e0b;
      }
      .hud-lives {
        display: flex;
        gap: 2px;
      }
      .heart {
        font-size: 1.1rem;
        transition: 0.3s;
      }
      .heart.dead {
        filter: grayscale(1);
        opacity: 0.25;
        transform: scale(0.7);
      }
      .hud-round {
        color: #a78bfa;
      }

      /* === SIMON AREA === */
      .simon-box {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(26, 17, 40, 0.5);
        border-radius: 20px;
        border: 1px solid rgba(167, 139, 250, 0.08);
        padding: 28px 20px;
        margin-bottom: 12px;
        position: relative;
        overflow: hidden;
        min-height: 220px;
      }
      .simon-bg-glow {
        position: absolute;
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(124, 58, 237, 0.12),
          transparent 70%
        );
        animation: glowPulse 4s ease-in-out infinite;
      }
      @keyframes glowPulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.4;
        }
        50% {
          transform: scale(1.3);
          opacity: 0.7;
        }
      }
      .wizard {
        font-size: 4.5rem;
        position: relative;
        z-index: 1;
        transition: 0.2s;
        filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.3));
      }
      .wizard.talk {
        animation: wizTalk 0.12s ease infinite alternate;
      }
      @keyframes wizTalk {
        from {
          transform: scale(1) rotate(-1deg);
        }
        to {
          transform: scale(1.06) rotate(1deg);
        }
      }

      .bubble {
        position: relative;
        z-index: 1;
        background: rgba(167, 139, 250, 0.12);
        border: 1.5px solid rgba(167, 139, 250, 0.25);
        border-radius: 16px;
        padding: 12px 20px;
        margin-top: 12px;
        min-height: 50px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        max-width: 360px;
      }
      .bubble-prefix {
        font-size: 0.85rem;
        color: #9b8fc2;
        font-weight: 600;
      }
      .bubble-cmd {
        font-size: 1.4rem;
        font-weight: 800;
        color: #f59e0b;
        margin: 2px 0;
      }
      .bubble-en {
        font-size: 0.8rem;
        color: #7b6fa0;
        font-weight: 500;
      }

      .replay-btn {
        position: absolute;
        top: 12px;
        right: 12px;
        background: rgba(167, 139, 250, 0.2);
        border: 1px solid rgba(167, 139, 250, 0.25);
        border-radius: 50%;
        width: 38px;
        height: 38px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 1.1rem;
        z-index: 2;
        transition: 0.2s;
        color: #fff;
      }
      .replay-btn:hover {
        background: rgba(167, 139, 250, 0.4);
        transform: scale(1.1);
      }
      .replay-btn.on {
        animation: speakPulse 0.5s ease infinite;
      }
      @keyframes speakPulse {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(167, 139, 250, 0.5);
        }
        50% {
          box-shadow: 0 0 0 10px rgba(167, 139, 250, 0);
        }
      }

      /* === ACTIONS === */
      .actions {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        flex-shrink: 0;
      }
      .act {
        padding: 6px;
        border-radius: 14px;
        border: 2.5px solid transparent;
        font-family: inherit;
        cursor: pointer;
        transition: 0.15s;
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0;
        position: relative;
        overflow: hidden;
      }
      .act::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          to bottom,
          rgba(255, 255, 255, 0.08),
          transparent
        );
        border-radius: 11px;
        pointer-events: none;
      }
      .act:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }
      .act:active {
        transform: scale(0.96);
      }
      .act-gif {
        width: 100%;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
        background: rgba(0, 0, 0, 0.15);
      }
      .act-emoji {
        font-size: 2.8rem;
        padding: 8px 0;
        display: inline-block;
      }
      /* Emoji animations */
      .anim-jump .act-emoji {
        animation: emojiJump 0.5s ease infinite;
      }
      .anim-clap .act-emoji {
        animation: emojiClap 0.4s ease infinite;
      }
      .anim-dance .act-emoji {
        animation: emojiDance 0.6s ease-in-out infinite;
      }
      .anim-sit .act-emoji {
        animation: emojiSit 0.8s ease infinite;
      }
      .anim-spin .act-emoji {
        animation: emojiSpin 1s linear infinite;
      }
      .anim-wave .act-emoji {
        animation: emojiWave 0.4s ease-in-out infinite alternate;
      }
      .anim-shake .act-emoji {
        animation: emojiShake 0.3s ease infinite;
      }
      .anim-pulse .act-emoji {
        animation: emojiPulse 0.8s ease-in-out infinite;
      }
      .anim-stomp .act-emoji {
        animation: emojiStomp 0.3s ease infinite;
      }
      .anim-fly .act-emoji {
        animation: emojiFly 1.2s ease-in-out infinite;
      }
      .anim-run .act-emoji {
        animation: emojiRun 0.3s linear infinite;
      }
      @keyframes emojiJump {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-12px);
        }
      }
      @keyframes emojiClap {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
      }
      @keyframes emojiDance {
        0% {
          transform: rotate(-8deg);
        }
        50% {
          transform: rotate(8deg);
        }
        100% {
          transform: rotate(-8deg);
        }
      }
      @keyframes emojiSit {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(6px);
        }
      }
      @keyframes emojiSpin {
        to {
          transform: rotate(360deg);
        }
      }
      @keyframes emojiWave {
        from {
          transform: rotate(-15deg);
        }
        to {
          transform: rotate(15deg);
        }
      }
      @keyframes emojiShake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-4px);
        }
        75% {
          transform: translateX(4px);
        }
      }
      @keyframes emojiPulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.15);
          opacity: 0.85;
        }
      }
      @keyframes emojiStomp {
        0%,
        100% {
          transform: translateY(0) scale(1);
        }
        50% {
          transform: translateY(4px) scale(1.1);
        }
      }
      @keyframes emojiFly {
        0%,
        100% {
          transform: translate(0, 0);
        }
        25% {
          transform: translate(4px, -6px);
        }
        75% {
          transform: translate(-4px, -3px);
        }
      }
      @keyframes emojiRun {
        0% {
          transform: translateX(-4px);
        }
        50% {
          transform: translateX(4px);
        }
        100% {
          transform: translateX(-4px);
        }
      }
      .act-label {
        font-size: 0.8rem;
        font-weight: 700;
        padding: 4px 0 2px;
      }
      .act-hint {
        font-size: 0.65rem;
        opacity: 0.6;
        font-weight: 500;
        padding-bottom: 2px;
      }
      .act.c-green {
        background: #10b981;
        border-color: #059669;
      }
      .act.c-red {
        background: #ef4444;
        border-color: #dc2626;
      }
      .act.c-blue {
        background: #3b82f6;
        border-color: #2563eb;
      }
      .act.c-orange {
        background: #f59e0b;
        border-color: #d97706;
      }
      .act.c-pink {
        background: #ec4899;
        border-color: #db2777;
      }
      .act.c-purple {
        background: #7c3aed;
        border-color: #6d28d9;
      }
      .act.c-teal {
        background: #14b8a6;
        border-color: #0d9488;
      }
      .act.correct-pop {
        animation: popGreen 0.5s ease;
      }
      @keyframes popGreen {
        0% {
          box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.8);
        }
        50% {
          box-shadow: 0 0 30px 8px rgba(16, 185, 129, 0.3);
          transform: scale(1.04);
        }
        100% {
          box-shadow: none;
        }
      }
      .act.wrong-pop {
        animation: popRed 0.5s ease;
      }
      @keyframes popRed {
        0% {
          box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.8);
        }
        50% {
          box-shadow: 0 0 30px 8px rgba(239, 68, 68, 0.3);
          transform: scale(0.95);
        }
        100% {
          box-shadow: none;
        }
      }

      /* === TOAST === */
      .toast {
        position: fixed;
        top: 16px;
        left: 50%;
        transform: translateX(-50%) translateY(-30px);
        padding: 10px 24px;
        border-radius: 50px;
        font-weight: 800;
        font-size: 1.05rem;
        z-index: 999;
        opacity: 0;
        transition: 0.3s cubic-bezier(0.22, 0.9, 0.25, 1);
        pointer-events: none;
        white-space: nowrap;
      }
      .toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
      .toast.ok {
        background: linear-gradient(135deg, #10b981, #06b6d4);
        box-shadow: 0 6px 24px rgba(16, 185, 129, 0.4);
      }
      .toast.bad {
        background: linear-gradient(135deg, #ef4444, #f97316);
        box-shadow: 0 6px 24px rgba(239, 68, 68, 0.4);
      }
      .toast.trick {
        background: linear-gradient(135deg, #f59e0b, #f97316);
        box-shadow: 0 6px 24px rgba(245, 158, 11, 0.4);
      }

      /* === COMBO === */
      .combo {
        position: fixed;
        top: 50%;
        right: 12px;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2px;
        opacity: 0;
        transition: 0.3s;
        z-index: 50;
      }
      .combo.on {
        opacity: 1;
      }
      .combo-fire {
        font-size: 1.3rem;
        animation: fireBob 0.4s ease infinite alternate;
      }
      @keyframes fireBob {
        from {
          transform: scale(1);
        }
        to {
          transform: scale(1.25);
        }
      }
      .combo-num {
        font-size: 2rem;
        font-weight: 900;
        color: #f59e0b;
        text-shadow: 0 0 16px rgba(245, 158, 11, 0.5);
      }
      .combo-lbl {
        font-size: 0.65rem;
        font-weight: 700;
        color: #a78bfa;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      /* === RESULTS === */
      .res-card {
        background: rgba(26, 17, 40, 0.9);
        border: 1px solid rgba(167, 139, 250, 0.15);
        border-radius: 20px;
        padding: 32px 24px;
        backdrop-filter: blur(20px);
        width: 100%;
        max-width: 420px;
      }
      .res-emoji {
        font-size: 4rem;
        margin-bottom: 8px;
      }
      .res-title {
        font-size: 1.8rem;
        font-weight: 900;
        margin-bottom: 4px;
      }
      .res-sub {
        color: #9b8fc2;
        margin-bottom: 20px;
        font-size: 0.95rem;
      }
      .res-stars {
        font-size: 2rem;
        letter-spacing: 6px;
        margin-bottom: 16px;
      }
      .res-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin-bottom: 16px;
      }
      .stat {
        background: rgba(37, 27, 58, 0.8);
        border-radius: 10px;
        padding: 12px 4px;
      }
      .stat-val {
        font-size: 1.5rem;
        font-weight: 900;
        color: #f59e0b;
      }
      .stat-lbl {
        font-size: 0.7rem;
        color: #9b8fc2;
        margin-top: 2px;
      }
      .words-box {
        background: rgba(37, 27, 58, 0.6);
        border-radius: 10px;
        padding: 12px;
        text-align: left;
        margin-bottom: 16px;
      }
      .words-box h4 {
        font-size: 0.8rem;
        color: #a78bfa;
        margin-bottom: 6px;
      }
      .word-tag {
        display: inline-block;
        background: rgba(167, 139, 250, 0.12);
        border: 1px solid rgba(167, 139, 250, 0.15);
        border-radius: 6px;
        padding: 2px 8px;
        margin: 2px;
        font-size: 0.78rem;
        font-weight: 600;
      }
      .again-btn {
        background: linear-gradient(135deg, #7c3aed, #ec4899);
        border: none;
        color: #fff;
        padding: 14px 44px;
        font-size: 1.1rem;
        font-weight: 800;
        border-radius: 50px;
        cursor: pointer;
        font-family: inherit;
        transition: 0.2s;
        box-shadow: 0 6px 24px rgba(124, 58, 237, 0.4);
      }
      .again-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(124, 58, 237, 0.5);
      }

      /* === CONFETTI === */
      .confetti {
        position: fixed;
        z-index: 800;
        animation: fall linear forwards;
        pointer-events: none;
      }
      @keyframes fall {
        0% {
          transform: translateY(-5vh) rotate(0);
          opacity: 1;
        }
        100% {
          transform: translateY(105vh) rotate(720deg);
          opacity: 0;
        }
      }

      /* === Responsive === */
      @media (max-width: 380px) {
        .wizard {
          font-size: 3.5rem;
        }
        .bubble-cmd {
          font-size: 1.15rem;
        }
        .act {
          padding: 10px 6px;
        }
        .act-emoji {
          font-size: 1.3rem;
        }
        .combo {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="bg">
      <div class="bg-orb"></div>
      <div class="bg-orb"></div>
      <div class="bg-orb"></div>
    </div>

    <div class="game-wrap">
      <!-- WELCOME -->
      <div class="screen active" id="s-welcome">
        <div class="logo">üßô‚Äç‚ôÇÔ∏è</div>
        <div class="title">Simon Says!</div>
        <div class="subtitle">Sim√£o Diz ‚Äî Portuguese Edition</div>
        <p class="desc">
          O feiticeiro Sim√£o d√° ordens em Portugu√™s!<br />
          Ouve bem e faz a a√ß√£o certa‚Ä¶ mas cuidado com os truques! üé≠
        </p>
        <button class="big-btn" onclick="showTutorial()">
          <span class="shine"></span>
          üéÆ Jogar! / Play!
        </button>
      </div>

      <!-- TUTORIAL -->
      <div class="screen" id="s-tutorial">
        <div class="tut-card">
          <div class="tut-step active" data-s="0">
            <div class="tut-icon">üëÇ</div>
            <div class="tut-title">Listen to Simon!</div>
            <div class="tut-text">
              Simon speaks in <b>Portuguese</b>.<br />
              He'll say a command like <b>"Salta!"</b> (Jump!)<br /><br />
              Tap üîä to hear it again!
            </div>
          </div>
          <div class="tut-step" data-s="1">
            <div class="tut-icon">‚úÖ</div>
            <div class="tut-title">Do the right action!</div>
            <div class="tut-text">
              If Simon says <b>"Sim√£o diz: salta!"</b>,<br />
              tap the <b>ü¶ò Jump</b> button!<br /><br />
              Match the command to the action.
            </div>
          </div>
          <div class="tut-step" data-s="2">
            <div class="tut-icon">‚ö†Ô∏è</div>
            <div class="tut-title">Watch for tricks!</div>
            <div class="tut-text">
              If he does <b>NOT</b> say "Sim√£o diz"‚Ä¶<br />
              <b>Don't move!</b> Tap <b>üö´ Do nothing!</b><br /><br />
              It's a trap! üòà
            </div>
          </div>
          <div class="tut-step" data-s="3">
            <div class="tut-icon">üèÜ</div>
            <div class="tut-title">Score big!</div>
            <div class="tut-text">
              <b>Fast answers = more points</b><br />
              <b>Combos = bonus!</b> üî•<br />
              You have <b>3 lives</b> ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è<br /><br />
              Good luck!
            </div>
          </div>
          <div class="tut-dots" id="tut-dots">
            <div class="tut-dot on"></div>
            <div class="tut-dot"></div>
            <div class="tut-dot"></div>
            <div class="tut-dot"></div>
          </div>
          <button class="tut-btn" id="tut-btn" onclick="tutNext()">
            Next ‚Üí
          </button>
        </div>
      </div>

      <!-- GAME -->
      <div class="screen" id="s-game">
        <div class="hud">
          <div class="hud-item hud-score">‚≠ê <span id="score">0</span></div>
          <div class="hud-item">
            <div class="hud-lives" id="lives">
              <span class="heart">‚ù§Ô∏è</span><span class="heart">‚ù§Ô∏è</span
              ><span class="heart">‚ù§Ô∏è</span>
            </div>
          </div>
          <div class="hud-item hud-round">üéØ <span id="round">1/15</span></div>
        </div>
        <div class="simon-box" id="simon-box">
          <button class="replay-btn" id="replay-btn" onclick="replay()">
            üîä
          </button>
          <div class="simon-bg-glow"></div>
          <div class="wizard" id="wizard">üßô‚Äç‚ôÇÔ∏è</div>
          <div class="bubble" id="bubble">
            <span class="bubble-prefix" id="b-prefix"></span>
            <span class="bubble-cmd" id="b-cmd">‚Ä¶</span>
            <span class="bubble-en" id="b-en"></span>
          </div>
        </div>
        <div class="actions" id="actions"></div>
      </div>

      <!-- RESULTS -->
      <div class="screen" id="s-results">
        <div class="res-card">
          <div class="res-emoji" id="r-emoji">üéâ</div>
          <div class="res-title" id="r-title">Great!</div>
          <div class="res-sub" id="r-sub">Well played!</div>
          <div class="res-stars" id="r-stars">‚≠ê‚≠ê‚≠ê</div>
          <div class="res-stats">
            <div class="stat">
              <div class="stat-val" id="r-score">0</div>
              <div class="stat-lbl">Points</div>
            </div>
            <div class="stat">
              <div class="stat-val" id="r-correct">0</div>
              <div class="stat-lbl">Correct</div>
            </div>
            <div class="stat">
              <div class="stat-val" id="r-streak">0</div>
              <div class="stat-lbl">Best Combo</div>
            </div>
          </div>
          <div class="words-box" id="words-box">
            <h4>üìö Words you practiced:</h4>
            <div id="words-list"></div>
          </div>
          <button class="again-btn" onclick="goHome()">üîÑ Play Again</button>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>
    <!-- Combo -->
    <div class="combo" id="combo">
      <div class="combo-fire">üî•</div>
      <div class="combo-num" id="combo-num">2</div>
      <div class="combo-lbl">COMBO</div>
    </div>

    <script>
      // ======= DATA =======
      var CMDS = [
        {
          id: "jump",
          pt: "Salta!",
          en: "Jump!",
          emoji: "ü¶ò",
          c: "c-green",
          gif: "gifs/jump.gif",
        },
        {
          id: "clap",
          pt: "Bate palmas!",
          en: "Clap!",
          emoji: "üëè",
          c: "c-blue",
          gif: "gifs/clap.gif",
        },
        {
          id: "dance",
          pt: "Dan√ßa!",
          en: "Dance!",
          emoji: "üíÉ",
          c: "c-pink",
          gif: "gifs/dance.gif",
        },
        {
          id: "sit",
          pt: "Senta-te!",
          en: "Sit down!",
          emoji: "ü™ë",
          c: "c-orange",
          gif: "gifs/sit.gif",
        },
        {
          id: "spin",
          pt: "Roda!",
          en: "Spin!",
          emoji: "üåÄ",
          c: "c-purple",
          gif: "gifs/spin.gif",
        },
        {
          id: "wave",
          pt: "Acena!",
          en: "Wave!",
          emoji: "üëã",
          c: "c-teal",
          gif: "gifs/wave.gif",
        },
        {
          id: "laugh",
          pt: "Ri-te!",
          en: "Laugh!",
          emoji: "üòÇ",
          c: "c-orange",
          gif: "gifs/laugh.gif",
        },
        {
          id: "sing",
          pt: "Canta!",
          en: "Sing!",
          emoji: "üé§",
          c: "c-pink",
          gif: "gifs/sing.gif",
        },
        {
          id: "whisper",
          pt: "Sussurra!",
          en: "Whisper!",
          emoji: "ü§´",
          c: "c-purple",
          gif: "gifs/whisper.gif",
        },
        {
          id: "nose",
          pt: "Toca no nariz!",
          en: "Touch your nose!",
          emoji: "üëÉ",
          c: "c-green",
          gif: "gifs/nose.gif",
        },
        {
          id: "eyes",
          pt: "Toca nos olhos!",
          en: "Touch your eyes!",
          emoji: "üëÄ",
          c: "c-blue",
          gif: "gifs/eyes.gif",
        },
        {
          id: "hand",
          pt: "Levanta a m√£o!",
          en: "Raise your hand!",
          emoji: "‚úã",
          c: "c-orange",
          gif: "gifs/hand.gif",
        },
        {
          id: "stomp",
          pt: "Bate o p√©!",
          en: "Stomp!",
          emoji: "ü¶∂",
          c: "c-red",
          gif: "gifs/stomp.gif",
        },
        {
          id: "fly",
          pt: "Voa!",
          en: "Fly!",
          emoji: "ü¶Ö",
          c: "c-purple",
          gif: "gifs/fly.gif",
        },
        {
          id: "run",
          pt: "Corre!",
          en: "Run!",
          emoji: "üèÉ",
          c: "c-green",
          gif: "gifs/run.gif",
        },
        {
          id: "stretch",
          pt: "Estica-te!",
          en: "Stretch!",
          emoji: "üßò",
          c: "c-pink",
          gif: "gifs/stretch.gif",
        },
        {
          id: "blow",
          pt: "Sopra!",
          en: "Blow!",
          emoji: "üå¨Ô∏è",
          c: "c-teal",
          gif: "gifs/blow.gif",
        },
      ];

      // ======= STATE =======
      var pts = 0,
        lives = 3,
        rnd = 0,
        TOTAL = 15,
        streak = 0,
        best = 0,
        correct = 0;
      var curCmd = null,
        simonSays = true,
        locked = false,
        tutStep = 0;
      var words = new Set(),
        lastSpeak = "";

      // ======= SCREENS =======
      function go(id) {
        document.querySelectorAll(".screen").forEach(function (s) {
          s.classList.remove("active");
        });
        document.getElementById("s-" + id).classList.add("active");
      }

      // ======= TUTORIAL =======
      function showTutorial() {
        tutStep = 0;
        go("tutorial");
        updTut();
      }
      function updTut() {
        document.querySelectorAll(".tut-step").forEach(function (s) {
          s.classList.remove("active");
        });
        document.querySelectorAll(".tut-step")[tutStep].classList.add("active");
        document.querySelectorAll(".tut-dot").forEach(function (d, i) {
          d.classList.toggle("on", i === tutStep);
        });
        document.getElementById("tut-btn").textContent =
          tutStep === 3 ? "üéÆ Let's go!" : "Next ‚Üí";
      }
      function tutNext() {
        if (tutStep < 3) {
          tutStep++;
          updTut();
        } else {
          startGame();
        }
      }

      // ======= VOICE ‚Äî Portugal Portuguese =======
      var ptVoice = null;
      var voicesReady = false;

      function findPtVoice() {
        if (!window.speechSynthesis) return;
        var voices = speechSynthesis.getVoices();
        if (!voices.length) return;
        voicesReady = true;
        var best = null,
          ptPT = null,
          ptGeneric = null,
          ptBR = null;
        for (var i = 0; i < voices.length; i++) {
          var v = voices[i];
          if (v.lang === "pt-PT" || v.lang === "pt_PT") {
            if (
              !best &&
              /premium|enhanced|neural|natural|joana|catarina/i.test(v.name)
            )
              best = v;
            if (!ptPT) ptPT = v;
          } else if (v.lang === "pt" && !ptGeneric) ptGeneric = v;
          else if ((v.lang === "pt-BR" || v.lang === "pt_BR") && !ptBR)
            ptBR = v;
        }
        ptVoice = best || ptPT || ptGeneric || ptBR || null;
        console.log(
          "Voice:",
          ptVoice ? ptVoice.name + " " + ptVoice.lang : "none found",
        );
      }
      if (window.speechSynthesis) {
        findPtVoice();
        speechSynthesis.onvoiceschanged = findPtVoice;
        setTimeout(findPtVoice, 200);
        setTimeout(findPtVoice, 1000);
      }

      function say(text, cb) {
        lastSpeak = text;
        var wiz = document.getElementById("wizard");
        wiz.classList.add("talk");

        if (!window.speechSynthesis) {
          setTimeout(function () {
            wiz.classList.remove("talk");
            if (cb) cb();
          }, 1500);
          return;
        }

        // Make sure voices are loaded
        if (!voicesReady) findPtVoice();

        speechSynthesis.cancel();
        var u = new SpeechSynthesisUtterance(text);
        u.lang = "pt-PT";
        u.rate = 0.88;
        u.pitch = 1.05;
        u.volume = 1;
        if (ptVoice) u.voice = ptVoice;

        var finished = false;
        function done() {
          if (finished) return;
          finished = true;
          wiz.classList.remove("talk");
          if (cb) cb();
        }
        u.onend = done;
        u.onerror = done;
        // Safety timeout in case onend never fires
        setTimeout(done, 5000);

        speechSynthesis.speak(u);
      }

      function replay() {
        if (!lastSpeak) return;
        var btn = document.getElementById("replay-btn");
        btn.classList.add("on");
        say(lastSpeak, function () {
          btn.classList.remove("on");
        });
      }

      // ======= SOUNDS =======
      function snd(type) {
        try {
          var c = new AudioContext();
          c.resume();
          var o = c.createOscillator(),
            g = c.createGain();
          o.connect(g);
          g.connect(c.destination);
          if (type === "ok") {
            o.type = "sine";
            o.frequency.setValueAtTime(523, c.currentTime);
            o.frequency.setValueAtTime(659, c.currentTime + 0.08);
            o.frequency.setValueAtTime(784, c.currentTime + 0.16);
            g.gain.setValueAtTime(0.25, c.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, c.currentTime + 0.35);
            o.start();
            o.stop(c.currentTime + 0.35);
          } else if (type === "bad") {
            o.type = "sawtooth";
            o.frequency.setValueAtTime(300, c.currentTime);
            o.frequency.linearRampToValueAtTime(150, c.currentTime + 0.25);
            g.gain.setValueAtTime(0.18, c.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, c.currentTime + 0.35);
            o.start();
            o.stop(c.currentTime + 0.35);
          } else if (type === "combo") {
            o.type = "sine";
            [784, 988, 1175, 1318].forEach(function (f, i) {
              o.frequency.setValueAtTime(f, c.currentTime + i * 0.07);
            });
            g.gain.setValueAtTime(0.22, c.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, c.currentTime + 0.45);
            o.start();
            o.stop(c.currentTime + 0.45);
          } else if (type === "win") {
            [523, 659, 784, 1047].forEach(function (f, i) {
              var o2 = c.createOscillator(),
                g2 = c.createGain();
              o2.type = "sine";
              o2.connect(g2);
              g2.connect(c.destination);
              o2.frequency.value = f;
              g2.gain.setValueAtTime(0.18, c.currentTime + i * 0.12);
              g2.gain.exponentialRampToValueAtTime(
                0.01,
                c.currentTime + i * 0.12 + 0.35,
              );
              o2.start(c.currentTime + i * 0.12);
              o2.stop(c.currentTime + i * 0.12 + 0.35);
            });
            return;
          } else if (type === "lose") {
            o.type = "triangle";
            o.frequency.setValueAtTime(440, c.currentTime);
            o.frequency.linearRampToValueAtTime(165, c.currentTime + 0.5);
            g.gain.setValueAtTime(0.25, c.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, c.currentTime + 0.6);
            o.start();
            o.stop(c.currentTime + 0.6);
          }
        } catch (e) {}
      }

      // ======= TOAST =======
      function toast(txt, cls) {
        var t = document.getElementById("toast");
        t.className = "toast " + cls;
        t.textContent = txt;
        requestAnimationFrame(function () {
          t.classList.add("show");
        });
        setTimeout(function () {
          t.classList.remove("show");
        }, 1600);
      }

      // ======= CONFETTI =======
      function confetti(n) {
        var cols = [
          "#A78BFA",
          "#EC4899",
          "#F59E0B",
          "#10B981",
          "#3B82F6",
          "#EF4444",
        ];
        for (var i = 0; i < n; i++) {
          var d = document.createElement("div");
          d.className = "confetti";
          d.style.left = Math.random() * 100 + "%";
          d.style.width = d.style.height = 5 + Math.random() * 8 + "px";
          d.style.background = cols[Math.floor(Math.random() * cols.length)];
          d.style.borderRadius = Math.random() > 0.5 ? "50%" : "2px";
          d.style.animationDuration = 1.5 + Math.random() * 2 + "s";
          d.style.animationDelay = Math.random() * 0.4 + "s";
          document.body.appendChild(d);
          setTimeout(function () {
            d.remove();
          }, 4000);
        }
      }

      // ======= COMBO =======
      function updCombo() {
        var el = document.getElementById("combo");
        if (streak >= 2) {
          el.classList.add("on");
          document.getElementById("combo-num").textContent = streak + "x";
        } else {
          el.classList.remove("on");
        }
      }

      // ======= HUD =======
      function updHUD() {
        document.getElementById("score").textContent = pts;
        document.getElementById("round").textContent = rnd + "/" + TOTAL;
        var hearts = document.querySelectorAll(".heart");
        hearts.forEach(function (h, i) {
          h.classList.toggle("dead", i >= lives);
        });
      }

      // ======= START =======
      function startGame() {
        pts = 0;
        lives = 3;
        rnd = 0;
        streak = 0;
        best = 0;
        correct = 0;
        words = new Set();
        updHUD();
        updCombo();
        go("game");
        nextRound();
      }
      function goHome() {
        go("welcome");
      }

      // ======= NEXT ROUND =======
      function nextRound() {
        if (rnd >= TOTAL || lives <= 0) {
          endGame();
          return;
        }
        rnd++;
        locked = false;
        updHUD();

        curCmd = CMDS[Math.floor(Math.random() * CMDS.length)];
        words.add(curCmd.pt + " (" + curCmd.en + ")");

        // 70% "Sim√£o diz", 30% trick
        simonSays = Math.random() < 0.7;

        var spoken = simonSays ? "Sim√£o diz: " + curCmd.pt : curCmd.pt;

        // Update bubble
        document.getElementById("b-prefix").textContent = simonSays
          ? "Sim√£o diz:"
          : "";
        document.getElementById("b-cmd").textContent =
          curCmd.emoji + " " + curCmd.pt;
        document.getElementById("b-en").textContent = "";

        say(spoken);
        buildBtns();
      }

      // ======= BUILD BUTTONS =======
      function buildBtns() {
        var area = document.getElementById("actions");
        area.innerHTML = "";

        var opts = [curCmd];
        var pool = CMDS.filter(function (c) {
          return c.id !== curCmd.id;
        });
        shuffle(pool);
        opts.push(pool[0], pool[1]);
        shuffle(opts);

        opts.forEach(function (cmd) {
          var b = document.createElement("button");
          b.className = "act " + cmd.c;
          b.innerHTML =
            '<img class="act-gif" src="' +
            cmd.gif +
            '" alt="' +
            cmd.en +
            "\" onerror=\"this.style.display='none';this.nextElementSibling.style.display='block'\">" +
            '<span class="act-emoji" style="display:none">' +
            cmd.emoji +
            "</span>" +
            '<span class="act-label">' +
            cmd.en +
            "</span>";
          b.onclick = function () {
            answer(cmd.id);
          };
          area.appendChild(b);
        });

        var nb = document.createElement("button");
        nb.className = "act c-red";
        nb.innerHTML =
          '<img class="act-gif" src="gifs/nothing.gif" alt="Do nothing" onerror="this.style.display=\'none\';this.nextElementSibling.style.display=\'block\'"><span class="act-emoji" style="display:none">üö´</span><span class="act-label">Do nothing!</span>';
        nb.onclick = function () {
          answer("nothing");
        };
        area.appendChild(nb);
      }

      // ======= ANSWER =======
      function answer(id) {
        if (locked) return;
        locked = true;

        var ok = false;
        if (simonSays) {
          ok = id === curCmd.id;
        } else {
          ok = id === "nothing";
        }

        var btns = document.querySelectorAll(".act");

        if (ok) {
          correct++;
          streak++;
          if (streak > best) best = streak;
          var bonus = 100 + (streak > 1 ? streak * 25 : 0);
          pts += bonus;

          // Flash correct button
          btns.forEach(function (b) {
            var lbl = b.querySelector(".act-label");
            if (lbl) {
              if (
                (simonSays && lbl.textContent === curCmd.en) ||
                (!simonSays && lbl.textContent === "Do nothing!")
              )
                b.classList.add("correct-pop");
            }
          });

          try {
            snd(streak >= 3 ? "combo" : "ok");
          } catch (e) {}
          if (!simonSays) {
            toast("üéØ Trick dodged! +" + bonus, "trick");
          } else {
            toast("‚úÖ Correct! +" + bonus, "ok");
          }
          if (streak >= 3) confetti(10);
        } else {
          lives--;
          streak = 0;

          // Show correct answer
          btns.forEach(function (b) {
            var lbl = b.querySelector(".act-label");
            if (lbl) {
              if (
                (simonSays && lbl.textContent === curCmd.en) ||
                (!simonSays && lbl.textContent === "Do nothing!")
              )
                b.classList.add("correct-pop");
            }
          });

          // Flash wrong
          btns.forEach(function (b) {
            var lbl = b.querySelector(".act-label");
            if (lbl) {
              if (
                (id === "nothing" && lbl.textContent === "Do nothing!") ||
                CMDS.some(function (c) {
                  return c.id === id && c.en === lbl.textContent;
                })
              )
                b.classList.add("wrong-pop");
            }
          });

          try {
            snd("bad");
          } catch (e) {}
          if (!simonSays) {
            toast("üò¨ Simon didn't say!", "bad");
          } else {
            toast("‚ùå Wrong action!", "bad");
          }
        }

        updCombo();
        updHUD();
        btns.forEach(function (b) {
          b.style.pointerEvents = "none";
        });
        setTimeout(nextRound, 1800);
      }

      // ======= END =======
      function endGame() {
        go("results");
        var emoji, title, sub, stars;
        if (lives <= 0) {
          emoji = "üíÄ";
          title = "Game Over!";
          sub = "Try again ‚Äî you can do it!";
          stars = correct >= 10 ? 2 : correct >= 5 ? 1 : 0;
          try {
            snd("lose");
          } catch (e) {}
        } else {
          var pct = correct / TOTAL;
          if (pct >= 0.9) {
            emoji = "üèÜ";
            title = "Incredible!";
            sub = "Simon is impressed!";
            stars = 5;
          } else if (pct >= 0.7) {
            emoji = "üéâ";
            title = "Great job!";
            sub = "Almost perfect!";
            stars = 4;
          } else if (pct >= 0.5) {
            emoji = "üëè";
            title = "Good work!";
            sub = "Keep practicing!";
            stars = 3;
          } else {
            emoji = "üí™";
            title = "Nice try!";
            sub = "Practice makes perfect!";
            stars = 2;
          }
          try {
            snd("win");
          } catch (e) {}
          confetti(40);
        }

        document.getElementById("r-emoji").textContent = emoji;
        document.getElementById("r-title").textContent = title;
        document.getElementById("r-sub").textContent = sub;
        document.getElementById("r-stars").textContent =
          "‚≠ê".repeat(stars) + "‚òÜ".repeat(5 - stars);
        document.getElementById("r-score").textContent = pts;
        document.getElementById("r-correct").textContent =
          correct + "/" + TOTAL;
        document.getElementById("r-streak").textContent = best + "x";

        var wl = document.getElementById("words-list");
        wl.innerHTML = "";
        words.forEach(function (w) {
          var s = document.createElement("span");
          s.className = "word-tag";
          s.textContent = w;
          wl.appendChild(s);
        });
      }

      // ======= HELPERS =======
      function shuffle(a) {
        for (var i = a.length - 1; i > 0; i--) {
          var j = Math.floor(Math.random() * (i + 1));
          var t = a[i];
          a[i] = a[j];
          a[j] = t;
        }
        return a;
      }
    </script>
  </body>
</html>
